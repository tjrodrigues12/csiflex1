CREATE PROCEDURE `usp_MonSetupCU`(IN in_operation varchar(50), 
    IN in_id int,
	IN in_monitoring_id varchar(20),
	IN in_machine_name varchar(200),
	IN in_monitoring_on_track int,
	IN in_machine_temp_filename varchar(200),
	IN in_mon_state_on int,
	IN in_part_count int,
	IN in_part_multiplier_mn int,
	IN in_cycle_identifier_ic int,
	IN in_min_ideal_ci int,
	IN in_max_perc_ca int,
	IN in_current_status varchar(50),
	IN in_last_cycle_time int,
	IN in_elapsed_time int,
	IN in_last_updated_date datetime,
	IN in_current_part_no varchar(100),
	IN in_department_name varchar(100),
	IN in_reset_counter_nm int)
BEGIN
	DECLARE mon_track INT unsigned DEFAULT 0;
	if in_operation = 'create' and !EXISTS (select id from csi_enetdata.tbl_monsetup where machine_temp_filename=in_machine_temp_filename limit 1) then
		INSERT INTO `csi_enetdata`.`tbl_monsetup`
		(`id`,
		`monitoring_id`,
		`machine_name`,
		`monitoring_on_track`,
		`machine_temp_filename`,
		`mon_state_on`,
		`part_count`,
		`part_multiplier_mn`,
		`cycle_identifier_ic`,
		`min_ideal_ci`,
		`max_perc_ca`,
		`current_status`,
		`last_cycle_time`,
		`elapsed_time`,
		`last_updated_date`,
		`current_part_no`,
		`department_name`,
		`reset_counter_nm`)
		VALUES
		(in_id,
		in_monitoring_id,
		in_machine_name,
		in_mon_state_on,
		in_machine_temp_filename,
		in_mon_state_on,
		in_part_count,
		in_part_multiplier_mn,
		in_cycle_identifier_ic,
		in_min_ideal_ci,
		in_max_perc_ca,
		in_current_status,
		in_last_cycle_time,
		in_elapsed_time,
		in_last_updated_date,
		in_current_part_no,
		in_department_name,
		in_reset_counter_nm);
	else
		
        set mon_track= (select monitoring_on_track from csi_enetdata.tbl_monsetup where machine_temp_filename=in_machine_temp_filename);
        if in_mon_state_on = 1 then
			set mon_track = 1;
		END IF;
        SET SQL_SAFE_UPDATES=0;
        UPDATE `csi_enetdata`.`tbl_monsetup`
		SET
		`monitoring_id` = in_monitoring_id,
		`machine_name` = in_machine_name,
		`monitoring_on_track` = mon_track,
		`machine_temp_filename` = in_machine_temp_filename,
		`mon_state_on` = in_mon_state_on,
		`part_count` = in_part_count,
		`part_multiplier_mn` = in_part_multiplier_mn,
		`cycle_identifier_ic` = in_cycle_identifier_ic,
		`min_ideal_ci` = in_min_ideal_ci,
		`max_perc_ca` = in_max_perc_ca,
		`last_cycle_time` = in_last_cycle_time,
		`elapsed_time` = in_elapsed_time,
		`department_name` = in_department_name,
		`reset_counter_nm` = in_reset_counter_nm
		where machine_temp_filename=in_machine_temp_filename;
	END IF;
END